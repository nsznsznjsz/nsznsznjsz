<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>TCP Protocol | Celeste&#39;s blog</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="Technique && Life">
    
    <link rel="preload" href="/notebook/assets/css/0.styles.2b364e15.css" as="style"><link rel="preload" href="/notebook/assets/js/app.9fa7afbe.js" as="script"><link rel="preload" href="/notebook/assets/js/2.33f5d3e6.js" as="script"><link rel="preload" href="/notebook/assets/js/4.8aa5ba20.js" as="script"><link rel="prefetch" href="/notebook/assets/js/10.3aad0b9a.js"><link rel="prefetch" href="/notebook/assets/js/11.3e09ee57.js"><link rel="prefetch" href="/notebook/assets/js/12.3b13ab5c.js"><link rel="prefetch" href="/notebook/assets/js/13.ba529909.js"><link rel="prefetch" href="/notebook/assets/js/14.33add7b9.js"><link rel="prefetch" href="/notebook/assets/js/15.6fa763e9.js"><link rel="prefetch" href="/notebook/assets/js/16.a9d424d5.js"><link rel="prefetch" href="/notebook/assets/js/17.551a5ee4.js"><link rel="prefetch" href="/notebook/assets/js/18.e0253e6f.js"><link rel="prefetch" href="/notebook/assets/js/19.4ab51a51.js"><link rel="prefetch" href="/notebook/assets/js/20.b5f2958e.js"><link rel="prefetch" href="/notebook/assets/js/21.e429ea39.js"><link rel="prefetch" href="/notebook/assets/js/22.500437ae.js"><link rel="prefetch" href="/notebook/assets/js/23.b91f4442.js"><link rel="prefetch" href="/notebook/assets/js/24.91148c5d.js"><link rel="prefetch" href="/notebook/assets/js/25.e19e3297.js"><link rel="prefetch" href="/notebook/assets/js/26.a56e44dc.js"><link rel="prefetch" href="/notebook/assets/js/27.9439f3d9.js"><link rel="prefetch" href="/notebook/assets/js/28.027349c9.js"><link rel="prefetch" href="/notebook/assets/js/29.4d0db5b7.js"><link rel="prefetch" href="/notebook/assets/js/3.4a22455e.js"><link rel="prefetch" href="/notebook/assets/js/30.b79ad02f.js"><link rel="prefetch" href="/notebook/assets/js/31.cea2ae31.js"><link rel="prefetch" href="/notebook/assets/js/5.2f919cce.js"><link rel="prefetch" href="/notebook/assets/js/6.22ff99d8.js"><link rel="prefetch" href="/notebook/assets/js/7.1f8a88df.js"><link rel="prefetch" href="/notebook/assets/js/8.b1ed59cf.js"><link rel="prefetch" href="/notebook/assets/js/9.7efb3190.js">
    <link rel="stylesheet" href="/notebook/assets/css/0.styles.2b364e15.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/notebook/" class="home-link router-link-active"><!----> <span class="site-name">Celeste's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机科学与技术" class="dropdown-title"><span class="title">计算机科学与技术</span> <span class="arrow down"></span></button> <button type="button" aria-label="计算机科学与技术" class="mobile-dropdown-title"><span class="title">计算机科学与技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/cs/computer-organization/" class="nav-link">
  计算机组成原理
</a></li><li class="dropdown-item"><!----> <a href="/notebook/cs/data-structure/" class="nav-link">
  数据结构
</a></li><li class="dropdown-item"><!----> <a href="/notebook/cs/network/" class="nav-link router-link-active">
  计算机网络
</a></li><li class="dropdown-item"><!----> <a href="/notebook/cs/others/" class="nav-link">
  杂谈
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="杂谈" class="dropdown-title"><span class="title">杂谈</span> <span class="arrow down"></span></button> <button type="button" aria-label="杂谈" class="mobile-dropdown-title"><span class="title">杂谈</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/others/coffee/" class="nav-link">
  咖啡
</a></li></ul></div></div> <a href="https://github.com/nsznsznjsz/notebook" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机科学与技术" class="dropdown-title"><span class="title">计算机科学与技术</span> <span class="arrow down"></span></button> <button type="button" aria-label="计算机科学与技术" class="mobile-dropdown-title"><span class="title">计算机科学与技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/cs/computer-organization/" class="nav-link">
  计算机组成原理
</a></li><li class="dropdown-item"><!----> <a href="/notebook/cs/data-structure/" class="nav-link">
  数据结构
</a></li><li class="dropdown-item"><!----> <a href="/notebook/cs/network/" class="nav-link router-link-active">
  计算机网络
</a></li><li class="dropdown-item"><!----> <a href="/notebook/cs/others/" class="nav-link">
  杂谈
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="杂谈" class="dropdown-title"><span class="title">杂谈</span> <span class="arrow down"></span></button> <button type="button" aria-label="杂谈" class="mobile-dropdown-title"><span class="title">杂谈</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/others/coffee/" class="nav-link">
  咖啡
</a></li></ul></div></div> <a href="https://github.com/nsznsznjsz/notebook" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/notebook/cs/network/" class="sidebar-heading clickable router-link-active open"><span>计算机网络</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/notebook/cs/network/tcp.html" aria-current="page" class="active sidebar-link">TCP Protocol</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notebook/cs/network/tcp.html#特点" class="sidebar-link">特点</a></li><li class="sidebar-sub-header"><a href="/notebook/cs/network/tcp.html#报文格式" class="sidebar-link">报文格式</a></li><li class="sidebar-sub-header"><a href="/notebook/cs/network/tcp.html#有限状态机及状态变迁" class="sidebar-link">有限状态机及状态变迁</a></li><li class="sidebar-sub-header"><a href="/notebook/cs/network/tcp.html#三次握手" class="sidebar-link">三次握手</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notebook/cs/network/tcp.html#为什么需要第三次握手" class="sidebar-link">为什么需要第三次握手?</a></li><li class="sidebar-sub-header"><a href="/notebook/cs/network/tcp.html#syn-flood-攻击" class="sidebar-link">SYN Flood 攻击</a></li></ul></li><li class="sidebar-sub-header"><a href="/notebook/cs/network/tcp.html#四次挥手" class="sidebar-link">四次挥手</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notebook/cs/network/tcp.html#为什么需要四次挥手" class="sidebar-link">为什么需要四次挥手?</a></li><li class="sidebar-sub-header"><a href="/notebook/cs/network/tcp.html#fin-wait-2-状态一直未接受到-fin-怎么办" class="sidebar-link">FINWAIT2 状态一直未接受到 FIN 怎么办?</a></li><li class="sidebar-sub-header"><a href="/notebook/cs/network/tcp.html#为什么存在-time-wait-状态" class="sidebar-link">为什么存在 TIME_WAIT 状态?</a></li></ul></li><li class="sidebar-sub-header"><a href="/notebook/cs/network/tcp.html#可靠传输" class="sidebar-link">可靠传输</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notebook/cs/network/tcp.html#自动重传请求协议-arq" class="sidebar-link">自动重传请求协议 ARQ</a></li></ul></li><li class="sidebar-sub-header"><a href="/notebook/cs/network/tcp.html#拥塞控制" class="sidebar-link">拥塞控制</a></li><li class="sidebar-sub-header"><a href="/notebook/cs/network/tcp.html#q-a" class="sidebar-link">Q&amp;A</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notebook/cs/network/tcp.html#为什么多个tcp可以连接同一端口-比如http的80端口" class="sidebar-link">为什么多个TCP可以连接同一端口，比如HTTP的80端口?</a></li><li class="sidebar-sub-header"><a href="/notebook/cs/network/tcp.html#rst-是什么-为什么会出现" class="sidebar-link">RST 是什么，为什么会出现</a></li></ul></li><li class="sidebar-sub-header"><a href="/notebook/cs/network/tcp.html#exercises" class="sidebar-link">Exercises</a></li></ul></li><li><a href="/notebook/cs/network/http.html" class="sidebar-link">HTTP Protocol</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="tcp"><a href="#tcp" class="header-anchor">#</a> TCP</h1> <p>Transmission Control Protocol，传输控制协议。属于传输层通信协议，基于TCP的应用层协议有: HTTP(s)，SMTP，FTP，Telnet 和 POP3</p> <p><strong>优点</strong>: 提供可靠传输，具有拥塞控制</p> <p><strong>缺点</strong>: 传输效率低，慢启动</p> <p></p><div class="table-of-contents"><ul><li><a href="#特点">特点</a></li><li><a href="#报文格式">报文格式</a></li><li><a href="#有限状态机及状态变迁">有限状态机及状态变迁</a></li><li><a href="#三次握手">三次握手</a><ul><li><a href="#为什么需要第三次握手">为什么需要第三次握手?</a></li><li><a href="#syn-flood-攻击">SYN Flood 攻击</a></li></ul></li><li><a href="#四次挥手">四次挥手</a><ul><li><a href="#为什么需要四次挥手">为什么需要四次挥手?</a></li><li><a href="#fin-wait-2-状态一直未接受到-fin-怎么办">FINWAIT2 状态一直未接受到 FIN 怎么办?</a></li><li><a href="#为什么存在-time-wait-状态">为什么存在 TIME_WAIT 状态?</a></li></ul></li><li><a href="#可靠传输">可靠传输</a><ul><li><a href="#自动重传请求协议-arq">自动重传请求协议 ARQ</a></li></ul></li><li><a href="#拥塞控制">拥塞控制</a></li><li><a href="#q-a">Q&amp;A</a><ul><li><a href="#为什么多个tcp可以连接同一端口-比如http的80端口">为什么多个TCP可以连接同一端口，比如HTTP的80端口?</a></li><li><a href="#rst-是什么-为什么会出现">RST 是什么，为什么会出现</a></li></ul></li><li><a href="#exercises">Exercises</a></li></ul></div><p></p> <h2 id="特点"><a href="#特点" class="header-anchor">#</a> 特点</h2> <p><strong>面向连接</strong>：使用 TCP 传输数据前，需先建立连接，传输完成后需释放连接。</p> <p><strong>全双工通信</strong>：建立 TCP 连接后，双方都可以发送数据</p> <p><strong>可靠通信</strong>：TCP协议保证数据不丢失，无差错，不重复且按序到达</p> <p><strong>面向字节流</strong>：数据以流的形式传输</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>TCP 会将数据报文分为数据段(data segment)传输，但由于其可靠性，上层可将其视为字节流传输</p></div> <h2 id="报文格式"><a href="#报文格式" class="header-anchor">#</a> 报文格式</h2> <p><img src="/notebook/assets/img/tcp-header.f0317cf2.jpg" alt="TCP Header - 20 byte"></p> <p>报文首部最小长度为20字节</p> <p><strong>源端口，目的端口</strong>：
表明发送端所使用的端口号和要连接的目标主机的端口号，不包含IP地址。</p> <p><strong>序号（seq）</strong>：
表明发送的数据包的顺序，一般为上次发送包中的顺序号+1。
若该数据包是整个TCP连接中的第一个包（SYN包），则该值是随机生成的。</p> <p><strong>确认号（ack）</strong>：
表明本端TCP已经接收到的数据，其值表示期待对端发送的下一个字节的序号。
实际上告诉对方，在这个序号减1以前的字节已正确接收。
若该数据包是整个TCP连接中的第一个包（SYN包），则确认号一般为0。</p> <p><strong>数据偏移</strong>：
表示以32位（4字节）为单位的TCP分组头的总长度（首部长度），用于确定用户数据区的起始位置。
在没有可变内容的情况下，TCP头部的大小为20字节，对应该值为5。</p> <p><strong>标志位</strong>：</p> <ul><li>紧急标志位（URG）：开启时表明此数据包处于紧急状态应该优先处理</li> <li>确认标志位（ACK）：开启时表明确认号有效，否则忽略确认号</li> <li>推送标志位（PSH）：开启时表明应该尽快交付给应用进程，而不必等到缓存区填满才推送，比如 telnet 的场景</li> <li>复位标志位（RST）：开启时表明TCP连接出现连接出现错误，数据包非法拒绝连接</li> <li>同步标志位（SYN）：开启时表明连接建立的标志</li> <li>终止标志位（FIN）：开启时表明释放一个连接</li></ul> <p><strong>窗口大小</strong>：
表明期望接受到的数据包字节数，用于拥塞控制。</p> <p><strong>校验和</strong>：
实现对TCP报文头以及数据区进行校验。</p> <p><strong>紧急指针</strong>：
在紧急状态下（URG打开），指出窗口中紧急数据的位置（末端）。</p> <p><strong>选项（可变）</strong>：
用于支持一些特殊的变量，比如最大分组长度(MSS)，然后将其填充为32 bit的整数倍。</p> <h2 id="有限状态机及状态变迁"><a href="#有限状态机及状态变迁" class="header-anchor">#</a> 有限状态机及状态变迁</h2> <p><img src="/notebook/assets/img/tcp-state-machine.43a09603.jpg" alt="TCP State Machine"></p> <p><img src="/notebook/assets/img/tcp-state-transition.803bd599.jpg" alt="TCP State Transition"></p> <h2 id="三次握手"><a href="#三次握手" class="header-anchor">#</a> 三次握手</h2> <p><img src="/notebook/assets/img/tcp-shake-hands.171d8920.jpg" alt="TCP Shake hands"></p> <p><strong>第一次握手</strong>：
客户端向服务器发送请求连接报文，SYN=1，seq=x(随机值)，客户端进入 SYN_SEND 状态，同时打开定时器</p> <p><strong>第二次握手</strong>：
服务器向客户端回信，SYN=1，ACK=1，seq=y(随机值)，ack=x+1，服务器端进入 SYN-RCVD 状态</p> <p><strong>第三次握手</strong>：
客户端向服务器回信，SYN=0，ACK=1，seq=x+1，ack=y+1，此次握手可以携带数据</p> <h3 id="为什么需要第三次握手"><a href="#为什么需要第三次握手" class="header-anchor">#</a> 为什么需要第三次握手?</h3> <p>这主要是为了防止已失效的连接请求报文段突然又传送到了B(服务器端)，因而产生错误。所谓“已失效的连接请求报文段”是这样产生的：</p> <p><strong>正常情况</strong></p> <p>A发出连接请求，但因连接请求报文丢失而未收到确认，于是A再重传一次连接请求。后来收到了确认，建立了连接。数据传输完毕后，就释放了连接。A共发送了两个连接请求报文段，其中第一个丢失，第二个到达了B，没有“已丢失的连接请求报文段”。</p> <p><strong>异常情况</strong></p> <p>A发出的第一个连接请求报文段并没有丢失，而是在某些网络节点长时间滞留了，以致延误到连接释放以后的某个时间才能到达B。</p> <p>本来这是一个早已失效的报文段。但B收到此失效的连接请求报文段后，就误认为A又发出了一次新的连接请求。于是又向A发出确认报文段，同意建立连接。</p> <p>假定不采用三次握手，那么只要B发出确认，新的连接就建立了。由于现在A并没有发出建立连接的请求，因此不会理睬B的确认，也不会向B发送数据。但B却以为新的连接已经建立了，并一直等待A发来数据，B的许多资源就这样浪费了。</p> <p>采用三次握手的方法可以防止上述异常现象的发生。</p> <div class="custom-block warning"><p class="custom-block-title">如果在规定时间内未收到回信</p> <p>会重新发送SYN报文段。如果在几次重发后仍然没有得到服务器的SYN+ACK响应就会放弃，端口切换CLOSE状态，并报告上层。</p></div> <h3 id="syn-flood-攻击"><a href="#syn-flood-攻击" class="header-anchor">#</a> SYN Flood 攻击</h3> <p>syn flood 是一种经典的 ddos攻击手段，这里面用到了TCP 三次握手存在的漏洞。
在上面的图中，可以看到当服务端接收到 SYN 后进入 SYN-RECV 状态，此时的连接称为<strong>半连接</strong>，同时会被服务端写入一个<strong>半连接队列</strong>。</p> <p>如果攻击者在短时间内不断的向服务端发送大量的 SYN 包而不响应，那么服务器的 半连接队列很快会被写满，从而导致无法工作。实现 syn flood 的手段，可以通过伪造源 IP 的方式，这样服务器的响应就永远到达不了客户端 (握手无法完成)，或通过设定客户端防火墙规则达到同样的目的。</p> <p>对 syn flood 实现拦截是比较困难的，可以通过启用 syn_cookies 的方式实现缓解，但最好的办法是通过专业的防火墙来解决。</p> <h2 id="四次挥手"><a href="#四次挥手" class="header-anchor">#</a> 四次挥手</h2> <p><img src="/notebook/assets/img/tcp-wave.43ee4064.jpg" alt="TCP wave"></p> <h3 id="为什么需要四次挥手"><a href="#为什么需要四次挥手" class="header-anchor">#</a> 为什么需要四次挥手?</h3> <p>当一方发送了FIN，则表示在这一方不再会有数据的发送，进入半关闭状态，但是仍需要接受对方发送的消息。</p> <p>其中当被动关闭方受到对方的FIN时，此时往往可能还有数据需要发送过去，因此无法立即发送FIN(也就是无法将FIN与ACK合并发送)，</p> <p>而是在等待自己的数据发送完毕后再单独发送FIN，因此整个过程需要四次交互。</p> <h3 id="fin-wait-2-状态一直未接受到-fin-怎么办"><a href="#fin-wait-2-状态一直未接受到-fin-怎么办" class="header-anchor">#</a> FIN_WAIT_2 状态一直未接受到 FIN 怎么办?</h3> <p>1。为实现全双工，TCP协议规定需要一直等待FIN才会进入<code>TIME_WAIT</code>，即使网线被剪短...
2。从Telnet，FTP，到Apache，Nginx，几乎所有的TCP服务的实现均遵循了收到客户端的FIN之后立即发送FIN这么一个不成文的事实，也就是说，对于主动关闭的一方，当它发送完FIN进入<code>FIN_WAIT_2</code>状态后，可以在预期的时间内收到对端的FIN从而进入TIMEWAIT状态
3。Linux 2.2 以上可以根据<code>tcp_fin_timeout</code>配置定时器时长，默认 60s，超时后并不会进入TIMEWAIT状态，也不会发送reset。而 Windows 下表现一致，但是会发送reset</p> <h3 id="为什么存在-time-wait-状态"><a href="#为什么存在-time-wait-状态" class="header-anchor">#</a> 为什么存在 TIME_WAIT 状态?</h3> <p>当客户端收到了对方的FIN时，会进入TIME_WAIT状态，需要等待 2MSL 以直到确认不会再有重传的数据包之后再进入CLOSED状态</p> <p>这么做的原因主要是为了可靠的关闭连接。为了防止网络不稳定情况，比如: 发送给对方的ACK可能会无法及时收到，此时对方可能重传FIN过来，如果提前进入CLOSE则会返回RST而不是ACK，就会影响关闭流程。</p> <p>如果频繁的主动关闭连接，可能会产生大量<code>TIME_WAIT</code>，由于<code>TIME_WAIT</code>的连接占用了一个句柄及少量内存(4K)，那么就有可能会影响其他连接的建立，</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>MSL叫Max Segment Lifetime，也就是关于一个数据包在网络中传输的最大生命周期的预设。关于其时长，RFC 中有 <code>Arbitrarily defined to be 2 minutes.</code></p></div> <h2 id="可靠传输"><a href="#可靠传输" class="header-anchor">#</a> 可靠传输</h2> <p>1。无差错
2。发送&amp;接受效率匹配</p> <h3 id="自动重传请求协议-arq"><a href="#自动重传请求协议-arq" class="header-anchor">#</a> 自动重传请求协议 ARQ</h3> <p><strong>定义</strong>
传输出现差错时，接收方自动请求发送方重传出错数据</p> <p><strong>作用</strong>
无差错传输</p> <p><strong>确认机制</strong>
1。发送方每发送一帧，都需要等待接收方应答信号
2。接收方每接受一帧，都需要反馈一个应答信号
3。若接收方不反馈应答信号，则发送方必需一直等待</p> <p><strong>超时重传</strong>
1。发送方发送帧后开启计时器
2。超时后重发该数据帧，直到发送成功为止</p> <h4 id="停等式-arq-stop-and-wait"><a href="#停等式-arq-stop-and-wait" class="header-anchor">#</a> 停等式 ARQ (Stop and Wait)</h4> <p>发送窗口大小 = 1
接受窗口大小 = 1</p> <h4 id="后退n帧协议-连续arq协议"><a href="#后退n帧协议-连续arq协议" class="header-anchor">#</a> 后退N帧协议 (连续ARQ协议)</h4> <p>发送窗口大小 &gt; 1
接受窗口大小 = 1</p> <h5 id="累计确认"><a href="#累计确认" class="header-anchor">#</a> 累计确认</h5> <p>收到多个数据分组后，只需对按序到达的最后一个分组确认</p> <p><strong>优点</strong>
实现简单</p> <p><strong>缺点</strong>
无法向发送方反馈所有正确接收到的分组信息</p> <h5 id="后退n帧"><a href="#后退n帧" class="header-anchor">#</a> 后退N帧</h5> <h2 id="拥塞控制"><a href="#拥塞控制" class="header-anchor">#</a> 拥塞控制</h2> <p>慢启动，拥塞避免，快速重传，快速恢复</p> <h2 id="q-a"><a href="#q-a" class="header-anchor">#</a> Q&amp;A</h2> <h3 id="为什么多个tcp可以连接同一端口-比如http的80端口"><a href="#为什么多个tcp可以连接同一端口-比如http的80端口" class="header-anchor">#</a> 为什么多个TCP可以连接同一端口，比如HTTP的80端口?</h3> <p>TODO</p> <h3 id="rst-是什么-为什么会出现"><a href="#rst-是什么-为什么会出现" class="header-anchor">#</a> RST 是什么，为什么会出现</h3> <p>RST 是一个特殊的标记，用来表示当前应该立即终止连接。以下这些情况都会产生RST：</p> <ul><li>向一个未被监听的端口发送数据</li> <li>对方已经调用 close 关闭连接</li> <li>存在一些数据未处理(接收缓冲区)，请求关闭连接时，会发送RST强制关闭</li> <li>某些请求发生了超时</li></ul> <p>RST 机制有时候也会被利用，做一些<a href="https://nmap.org/man/zh/man-port-scanning-techniques.html" target="_blank" rel="noopener noreferrer">端口扫描<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="exercises"><a href="#exercises" class="header-anchor">#</a> Exercises</h2> <p>1。A,B两台机器都正常工作,B机器未监听任何端口。如果A机器向B机器80端口发送SYN包,会收到何种类型的回包?</p> <blockquote><p>RST包</p></blockquote> <p>2。TCP建立连接的过程采用三次握手，已知第三次握手报文的发送序列号为1000，确认序列号为2000，请问第二次握手报文的发送序列号和确认序列号分别为?</p> <blockquote><p>1999,1000</p></blockquote></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/nsznsznjsz/notebook/edit/master/docs/cs/network/tcp.md" target="_blank" rel="noopener noreferrer">编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2021/1/23 下午2:35:28</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/notebook/cs/network/http.html">
        HTTP Protocol
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/notebook/assets/js/app.9fa7afbe.js" defer></script><script src="/notebook/assets/js/2.33f5d3e6.js" defer></script><script src="/notebook/assets/js/4.8aa5ba20.js" defer></script>
  </body>
</html>
